## Emissions Levels and Life Satisfaction
### A Study on the German States

```{r, include = FALSE}

setwd("~/Documents/Hertie 2016/Collaborative Social Science Data/Research Project/GitHub/Climate-Happiness")

library(DataCombine)
library(WDI)
library(survival)
library(ggplot2)
library(Hmisc)

library(knitr)
library(googleVis)
library(Zelig)
source("Data/AnalysisSource.R")


library(repmis)

possibles <- c('~/GitHub/Climate-Happiness/', 
               '~/Documents/Hertie 2016/Collaborative Social Science Data/Research Project/GitHub/Climate-Happiness/')
set_valid_wd(possibles)


data3 <- read.csv("All_Merged_Data.csv")
attach(data3)

```

```{r echo=FALSE, results='hide', message=FALSE}

suppressPackageStartupMessages(library(googleVis))

#aggregate yearly emissions data by state
agg <- aggregate(cbind(CO2perSqKm) ~ State + Year + Stateid, FUN=mean, data=data3)

allvar <- aggregate(cbind(CO2perSqKm, satis, environ, GrossIncome) ~ State + Year + Stateid, FUN=mean, data=data3)

#Transform yearly data to numeric
transform(agg, Year = as.numeric(Year))

Replace1 <- data.frame(from = c("Baden-W\xcc_rttemberg", "Th\xcc_ringen"), to = c("Baden-Wuerttemberg", "Thueringen"))
                       
allvar <- FindReplace(data=allvar, Var = "Stateid", replaceData = Replace1, from = "from", to = "to",
  exact = TRUE, vector = FALSE)

allvar <- FindReplace(data=allvar, Var = "State", replaceData = Replace1, from = "from", to = "to",
  exact = TRUE, vector = FALSE)

#create new vector with state codes

Replaces <- data.frame(from = c("Baden-Wuerttemberg", "Bayern", "Bremen", "Berlin", "Brandenburg", "Hamburg" , "Hessen", "Mecklenburg-Vorpommern", "Niedersachsen", "Nordrhein-Westfalen", "Rheinland-Pfalz", "Sachsen", "Sachsen-Anhalt", "Schleswig-Holstein", "Saarland", "Thueringen"), to = c("DE-BW", "DE-BY", "DE-HB", "DE-BE", "DE-BB", "DE-HH", "DE-HE", "DE-MV", "DE-NI", "DE-NW", "DE-RP", "DE-SN", "DE-ST", "DE-SH", "DE-SL", "DE-TH"))

New <- FindReplace(data=allvar, Var = "Stateid", replaceData = Replaces, from = "from", to = "to",
  exact = TRUE, vector = FALSE)

New[, c(2,4)] <- sapply(New[, c(2,4)], as.numeric)


## Create Geo Charts for each year

geoChartDE <- list(region="DE", 
                   resolution="provinces",
                   legend="{numberFormat:'#,###.00'}") 
```


### Introduction 

Climate change is undoubtedly a global problem, but this fact means it is also, in a way, a classic tragedy of the commons. No country wants to put itself at an economic disadvantage by restricting the use of cheap fossil fuels so all continue to emit, deteriorating the "commons" of the Earth's protective atmosphere. This can make it difficult to get citizens to identify with the problem and take responsibility; people will more likely act when something affects them individually. In this paper we want to explore this aspect: how much do people feel, consciously or unconsciously, the effects of green house gas emissions? More specifically, do emissions affect their reported health, well-being, or life satisfaction?  

<img src="Emissions.jpg"/> 

To examine this question, we will look at data from Germany. Germany is a leader in protecting the environment while also having a long history as an industrial power and coal producer. One one hand, its energy transition (*Energiewende*) is considered one of the most ambitious climate policy projects in the world. On the other hand, it has struggled with appropriate incentives, a drop in oil prices---not to mention coal's continued role as a cheap and reliable fuel---and how to transform the transportation sector. Germany therefore still does emit large amounts of green house gases. We will look at green house gas emissions data by federal state (*Bundesland*) and compare that with life satisfaction data to examine our first hypothesis:

> *H1: Bundeslaender with higher emissions will have lower reported levels of health, well-being, or life satisfaction.* 

We will also investigate whether there is a time component to perceptions of life satisfaction and well-being. This is important because, as explained in more depth in the literature review, there is a possibe endogeneity problem. Individuals may be unhappy with more pollution, but unhappy individuals may be bothered more by pollution. Germany's emissions have been reduced since 1990, though reductions have stagnated recently. By tracking responses over time, we hope to tell if there is a time component: do changes in emissions precede changes in life satisfaction? There are some studies that have used a time series approach, but not many have done so a a country level. Using German emissions and happiness data going back to 1990, our second hypothesis is:

> *H2: Reported levels of health, well-being or life satisfaction will reflect changes in emissions in line with hypothesis above, i.e. as emissions decline, reported levels of health, well-being, and life satisfaction will rise.* 


### Average Emissions per Square KM by State

The map below illustrates the amount CO2e emissions (tons) per square kilometer in Germany. The information is based on averaged data between 1990-2012 from Statista. The values represent the average over time in the German states.

```{r, echo=FALSE, fig.align = 'center', fig.cap = "State Emissions per Sq KM", results='asis'}
# Plot
Map <- gvisGeoChart(New, locationvar = 'State',
                      colorvar = 'CO2perSqKm',
                      options = geoChartDE)

plot(Map, tag = 'chart')

```

```{r echo=FALSE, results='hide', message=FALSE}
# Plot

## Get life expectancy and population figures from the World Bank
wbData <- WDI(country="all", indicator=c("SP.DYN.LE00.IN",
                               "SP.POP.TOTL"), start=1960, end=2011,
              extra=FALSE)

names(wbData) <- c("country", "iso2c", "year", "life.expectancy",
                   "population")

worlddata <- read.csv("CO2_Data.csv")
attach(worlddata)

## Get country mappings from World Bank
getWorldBankCountries <- function(){
  wbCountries <-
    fromJSON("http://api.worldbank.org/countries?per_page=12000&format=json") 

  wbCountries <- data.frame(t(sapply(wbCountries[[2]], unlist)))
  wbCountries$longitude <- as.numeric(wbCountries$longitude)
  wbCountries$latitude <- as.numeric(wbCountries$latitude)
  levels(wbCountries$region.value) <- gsub(" \\(all income levels\\)",
                                           "", levels(wbCountries$region.value))
  return(wbCountries)
}

## Get country mappings
wbCountries <- getWorldBankCountries()

total <- merge(wbCountries, worlddata, 
                by.x="name", by.y="Country")

names(total) <- c("country", "id", "iso2Code", "RegionID", "RegionValue", "ID2", "Region", "Income.Level.ID", "IncomeLevel", "LendingType", "LendingValue", "Capital", "Longitude", "Latitude", "CO2EmissionsMt", "NotA", "ChangeSince1990", "NotB", "CO2perCapita", "NotC", "CO2perSquareKM", "NotD")

geoChartworld <- list(region="world", 
                   resolution="countries",
                   legend="{numberFormat:'#,###.00'}")

WorldMap <- gvisGeoChart(total, locationvar = 'iso2Code',
                      colorvar = 'CO2perSquareKM',
                      options = geoChartworld)
```

<br><br>

### Global Emissions per Square Kilometer
The map below illustrates the amount CO2e emissions (tons) per square kilometer globally. The information is based on 2007 Data from the United Nations Department of Economic and Social Affairs. Compared to the values of countries, both in the same geographic area, and globally, Germany has extremely high levels of emissions per square kilometer. 


```{r, echo=FALSE, fig.align = 'center', results='asis'}
plot(WorldMap, tag = 'chart')

```

<br><br>

### Comparing Effects of Variables on Life Satisfaction by State

The dynamic chart below allows an examination of the correlation between the variables of interest and overall life satisfaction. The highlights the changes for each of the German states between the years 1990-2012. Scroll through the years at the bottom to see the changes in values over time for each state.

```{r, echo=FALSE, fig.align = 'center', fig.cap="Effects of Variables on Satisfation Across States and Time", results='asis'}
M1 <- gvisMotionChart(allvar, idvar="State", timevar="Year")
plot(M1, tag = 'chart')

```

<br><br>


### What Determines Overall Satisfaction?

#### Effects of Age on Life Satisfaction

Using the means of each state, the scatterplot below shows the correlation between the age of respondents and their overall happiness levels. Life satisfaction appears to be positively correlated with age, in that as respondents age, their overall satisfaction levels decrease.

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.height=4}

# Find some helpful averages
individMeans <- aggregate(data3[, c("GrossIncome", "age", "fam", "emp")], by = list(Year), FUN = mean)
names(individMeans) <- c("Year", "MeanIncome", "MeanAge", "AveFam","AveEmp")

# Set as percentage
individMeans$AveFam <- (individMeans$AveFam-1)*100
aggremeans <- aggregate(data3[, c("WorkHours","GrossIncome","satis","environ","age",
                                 "emp","fam","CO2perSqKm","Emissions")], list(State, Year), mean)

#Boxplot of emissions levels by state

ggplot(data = aggremeans, aes(x=age, y=satis)) + geom_point() +geom_smooth(colour="#2ca25f") + labs(x = "Age", y = "") + theme_bw()
```

<br><br>

#### Effects of Work Hours on Life Satisfaction

Below shows the correlation between number of work hours per week and overall happiness levels. Life satisfaction appears to have little to no correlation with emissions, as the line is almost flat.

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.height=4}

ggplot(data = aggremeans, aes(x=WorkHours, y=satis)) + geom_point() +geom_smooth(colour="#2ca25f") + labs(x = "Work Hours per Week", y = "") + theme_bw()
```

<br><br>

#### Effects of Gross Monthly Income on Life Satisfaction

Below shows the correlation between monthly income and overall happiness levels. Life satisfaction appears to have little to no correlation with emissions, as the line is almost flat.

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.height=4}

ggplot(data = aggremeans, aes(x=GrossIncome, y=satis)) + geom_point() +geom_smooth(colour="#2ca25f") + labs(x = "Monthly Gross Income", y = "") + theme_bw()
```

<br><br>
#### Effects of Emissions per Square Kilometer on Life Satisfaction

Below shows the correlation between the level of emissions per square kilometers and overall happiness levels. Life satisfaction appears to have little to no correlation with emissions, as the line is almost flat.

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.height=4}

ggplot(data = aggremeans, aes(x=CO2perSqKm, y=satis)) + geom_point() +geom_smooth(colour="#2ca25f") + labs(x = "Emissions per Sq KM", y = "") + theme_bw()
```

<br><br>

#### Effects of Emissions per Capita on Life Satisfaction

Below shows the correlation between the level of emissions per capita (per person) and overall happiness levels. Life satisfaction appears to have a small, negative correlation with emissions, indicating that the higher emissions per capita, the lower the overall happiness of respondents.

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.height=4}

ggplot(data = aggremeans, aes(x=Emissions, y=satis)) + geom_point() +geom_smooth(colour="#2ca25f") + labs(x = "Emissions per Capita", y = "") + theme_bw()

```

<br><br>

### Effects of Concern for the Environment on Life Satisfaction

Below shows the correlation between the level of concern about the environment by respondents and overall happiness levels. Life satisfaction appears to have a negative correlation with environmental concern, indicating that the more concerned a respondent is about environmental conditions, the lower the overall happiness of respondents.

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.height=4}

ggplot(data = aggremeans, aes(x=environ, y=satis)) + geom_point() +geom_smooth(colour="#2ca25f") + labs(x = "Concern about the Environment", y = "") + theme_bw()
```

<br><br>

### Overview of Emissions by State

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.height=4}
boxplot(Emissions~State,
  data=data3,
  main="Emissions by State",
  xlab="State",
  ylab="Emissions (annual tons of CO2 per capita)",
  col="#2ca25f",
  border="#99d8c9"
)
```

### Conclusions

Interestingly, emissions, in total amount, per capita and per land size, does not appear to have a significant effect on reported life satisfaction in any of the models. The other variables are statistically significant in all the models. For variables other than gender, the directions of the relationships are also the same across models: emissions and age have negative coefficients, while concern about the environment and energy use have positive coefficients.

The output of our multi-level modeling demonstrates that the State emissions are indeed negatively related to the individual happiness. However, after controlling for the individual environmental concerns, the coefficient (-0.005) is not statistically significant. Consequently, the group-level effect does not significantly differ from the individual-level. On the other hand, the coefficient of environmental concerns statistically differs from 0, but the direction is oddly positive counter the expectations. These results point at the omitted variables (absence of the demographic characteristics) that should be included in the further model. Similarly, the surprising direction of the environmental coefficient demands investigation of endogeneity between reported happiness and environmental concerns. 